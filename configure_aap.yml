---
- name: Include vars
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Include variables
      tags: always
      block:
        - name: Ensure aap_version has been provided
          ansible.builtin.assert:
            that:
              - aap_version is defined
              - aap_version in ['24', '25']
            fail_msg: "Please specify aap_version as '24' or '25'"

        - name: Ensure object_set has been provided
          ansible.builtin.assert:
            that:
              - object_set is defined
              - object_set in ['A', 'B', 'empty', 'null']
            fail_msg: "Please specify aap_version as 'A', 'B', 'empty' or 'null'"

        - name: Include galaxy.yml with current collection version
          ansible.builtin.include_vars: "ansible_collections/configify/aapconfig/galaxy.yml"
          ignore_errors: true

        - name: Include var files unless null
          when: object_set != 'null'
          block:
            - name: Include all vars
              ansible.builtin.include_vars: "test_objects_set_{{ object_set }}"
          
            - name: Include role vars
              ansible.builtin.include_vars: "test_objects_set_{{ object_set }}_roles_{{ aap_version }}"

#        - name: Include objects
#          ansible.builtin.include_vars:
#            dir: objects
#            extensions:
#              - ''

- name: Run playbook to configure AAP
  import_playbook: configify.aapconfig.aap_configure.yml
  vars:
    github_pat: !vault |
                $ANSIBLE_VAULT;1.1;AES256
                64356465343061366238313232663663363337363639373636643339326563353162396330663837
                3031313561356439663035363733643036313263616361300a306161373764366330333565376433
                63356161363262663633393535386366613838306238386165613231303261336334373139363838
                3333366530386661650a613936633637313266326664313739613764386166633538333166366531
                39646666623239333464386262656630663736373534323536346366326439396137386239656465
                30376638393931623138663639373162396566313339613938613633343230393531623133643461
                64666536353136643735306639646339646163303566366535653966643366663030303530666363
                33626164666635663662366630306535373934366234356132386565623435326465333064616634
                6437
    rhhub_pat: !vault |
                $ANSIBLE_VAULT;1.1;AES256
                38653239363661316236356363343165396137663065646533656439616539373234363862343437
                6365353361363364616662643763356137643436393839330a643065363831656439333335393465
                61626436616161646236366332353438323733323332616139366364636433306263643030363236
                3132333636393035310a633536613234346364633332356232323930316663303636646562393337
                61396332633836353365653464323961306163663832366561326537653034346266346262636435
                33656561396635613335613533616337633430303864646164313335303166353365366566303461
                35323665626339383963376139303733656161396166336639643632333631323839663364663938
                66643965323438326365343234303035643232396137363130666331363261663737353065613730
                66313136616234326466343763333166373561663237623562326135633234623433363838626464
                36386530353135663834363832393463353239613636363638633263343664396164346330326437
                32383465323434323665383830356235326330333264653037306530663035666238393435356137
                64636663613864323466333732323636303162623235303033303563313437396363653363346664
                39386632376136646139363131373839626634616261333964386137636131356239336631626664
                34353139386563613833313330376535333033656436303137616339376264663664646531373231
                33646363373035326231333634396135306332396332626265346331353564366336336462653032
                30336635643533356638366634346336663639363461346638373730326630643466383464613065
                37303436376333366237323566653138616336666662663862633938363734303937306363306638
                61326565633536383936303138343138356636333635653635323338623161613831616561353130
                37323339616664303433306366623364636238326433323637336162383634316665313532636164
                33386634373337616232653061393039383830633539613961326337323438393338646366353462
                30656133333162333365643965376333383133656266633238303933633537346466326166623737
                31666664353062396233366330363965653164316438313966656166343738326534613737613734
                65623061366238386564353537313135656539336562363339313066303764353561336534366564
                65663333376632373232396536623966623064303865663935326335386237313762613762336563
                62633261366337326334333565633339316461653862393938636164626165326263613464656461
                32653131633662656561636535656135383231396363636564366635343037343838373461656533
                38326236316439383034393431383038396463396335393761393562363062393436323663376134
                63396433363735616664623034663130336538656466643865663338326462393330613661663036
                30613137663134336439383865313662643733366435623830363562616635326136353662393866
                61323066653739303830363138666635313862646161336435303166333165653163303866323262
                61343961373464393030383333616166656639366138656365316531346534336639653834663335
                38373330383130383135313137353134343430663837386462383937633066633966373733653934
                34353066326636343364663065626234643239626139363765666436616638656336396533353035
                61383434363666303534323962353462643537306466386161636138323464653930636537383838
                61313437303563383233663230383035343832616535343436653434346263633131383630313564
                38393462343435306635396263613465333639333338386365616366613066643532656530363930
                61653431646235376366313761366539623638663939323932666530383462393264326636363938
                32653130323864616166633632646137663462303833316264366334613138656263633734393163
                31613338313337613638303762346538396164623130323062363764306334643539613531623633
                63313732373334653165363234616564633437396264626265343737303261616565633263316439
                62376631643164363432343965346263613366366339373766646663323533653139356664356236
                30653239613732646564396164653832393133366537656531636637346337313232303463656630
                61306332373837343264306536333330303432313039366634653162306562643332663330663664
                66316635386335643862323039646135663731316233646632663663626462646335643566636364
                37613733363430386263353430396636383934623733303963613061653565633430303466336264
                3433323265663962376363353539376337303034363231666361
    hub_pat:
      '24': !vault |
            $ANSIBLE_VAULT;1.1;AES256
            66616631653164656130366637383863343964343937343164616138353331366463373639616562
            3766643833623932653265656662326331386131306234330a346635313532653239366136623662
            39323430366231366236636332393166613065303639636134663765383932343866663839393961
            3038313861396530330a643033613335616461363362343938363439653663646261386462333432
            64376461633938343563623530356537346530336132386438306162316538316135343835366466
            6634636634343634346635613637653835303065313236666337
      '25': !vault |
            $ANSIBLE_VAULT;1.1;AES256
            65363432316336333830613336633331333936653638663036386661623666653530366563613734
            6232333063306266616532353863393933643731346131320a393763326562626464323231323134
            64333330663936393031326466323433643239326265333262326133633233336434326461626361
            3266646335373831630a383838366230356563613963623835666164323738333062383865653361
            39316436396438373735393437333330663134646533306463313136366431383033343065626238
            3235393964383235336666616662356535303533343361353030
    api_prefix:
      '24': '/api/'
      '25': '/api/controller/'
    hub_endpoint:
      '24': '{{ lookup("ansible.builtin.env", "AH_HOST") }}'
      '25': '{{ lookup("ansible.builtin.env", "GATEWAY_HOSTNAME") }}'
    hostname_hub:
      '24': '{{ lookup("ansible.builtin.env", "AH_HOST") }}'
      '25': 'hub25.int'
    hostname_controller:
      '24': '{{ lookup("ansible.builtin.env", "CONTROLLER_HOST") }}'
      '25': 'tower25.int'
